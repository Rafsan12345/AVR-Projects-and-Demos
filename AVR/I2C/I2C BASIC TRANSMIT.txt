#define F_CPU 8000000UL // Define CPU frequency
#include <avr/io.h>         // AVR IO library
#include <util/delay.h>    // Delay library
#include <stdint.h>        // Standard integer types

// Define the I2C address for the PCF8574 (LCD I2C expander)
#define PCF8574_ADDR (0x27 << 1) // Shift left to match the I2C address format

void i2c_init_master() {
	TWSR &= 0xF8;              
	TWBR = 0x07;              
	TWCR |= (1 << 2);      
}

void i2c_start() {
	// Send start condition
	TWCR = (1 << 7) | (1 << 5) | (1 << 2);
	while ((TWCR & (1 << 7))==0); // Wait for TWINT flag set
}

void i2c_stop() {
	// Send stop condition
	TWCR = (1 << 4) | (1 << 2)| (1 << 7);
}

void i2c_write(char data) {
	// Write data to I2C
	TWDR = data;               // Load data into data register
	TWCR = (1 << 7) | (1 << 2); // Start transmission
	while ((TWCR & (1 << 7))==0); // Wait for TWINT flag set
}


int main(void) {
	i2c_init_master();
	i2c_start();
	i2c_write(0x27);
	i2c_stop();

	while (1) ;
}
